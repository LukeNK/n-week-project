---
layout: base
---
<style>
    data {
        display: none;
    }
</style>

<!-- Import data -->
{% for collection in site.collections %}
    {% for page in collection.docs %}
        <data
            subject="{{ collection.name }}"
            chapter="{{ page.url | slice: 1, page.url.size | replace: '/', '-' }}"
        >{{ page.prerequisites | join: ',' }}</data>
    {% endfor %}
{% endfor %}
<main>
    <header>
        <div>
            <img src="https://lukenk.github.io/print/letterhead.svg" alt="">
            <p class="med">
                LukeNK
            </p>
        </div>
        <p class="large">THE NOTE OF SCIENCE&nbsp;TOPICS</p>
        <p>
            N-week project<br>
            Publication <time></time>
        </p>
    </header>

    <table id="navLevels">
        <caption>Prerequisite Levels</caption>
    </table>
</main>

<!--
    Assign course numbering to each chapter
    Each chapter with be assigned a four-digit code
    The first two digits are the level of the chapter, starting from 00 for subjects with no prerequisites
-->
<script>
    const dataElements = document.querySelectorAll('data');
    const chapters = {};

    // First pass: collect prerequisites
    dataElements.forEach((data, number) => {
        const subject = data.getAttribute('subject');
        const chapter = data.getAttribute('chapter');
        const prerequisites = data.textContent.split(',').filter(prereq => prereq.trim() !== '');
        chapters[chapter] = { subject, prerequisites, level: 0, number: number + 1 };
    });

    // Function to compute level recursively
    function computeLevel(chapter) {
        if (chapters[chapter].level > 0) {
            return chapters[chapter].level;
        }
        if (chapters[chapter].prerequisites.length === 0) {
            chapters[chapter].level = 0;
            return 0;
        }
        let maxPrereqLevel = 0;
        chapters[chapter].prerequisites.forEach(prereq => {
            if (chapters[prereq]) {
                const prereqLevel = computeLevel(prereq);
                if (prereqLevel > maxPrereqLevel) {
                    maxPrereqLevel = prereqLevel;
                }
            }
        });
        chapters[chapter].level = maxPrereqLevel + 1;
        return chapters[chapter].level;
    }

    // Second pass: compute levels
    Object.keys(chapters).forEach(chapter => {
        computeLevel(chapter);
    });

    // sort by level
    const sortedChapters = Object.keys(chapters).sort((a, b) => {
        return chapters[a].level - chapters[b].level;
    });

    // Output result as table, with each row is a level
    const table = document.getElementById('navLevels');
    let currentLevel = -1;
    sortedChapters.forEach(chapter => {
        const level = chapters[chapter].level;
        if (level !== currentLevel) {
            currentLevel = level;
            table.innerHTML += `<tr><th colspan="2">Level ${level}</th></tr>`;
        }

        let link = chapter.replace('-', '/');

        table.innerHTML += `<tr>
            <td><a href="{{ site.url }}/${link}">${link}</a></td>
            <td><a href="{{ site.url}}#${chapter}">Chapter ${chapters[chapter].number}</a></td>
        </tr>`;
    });
</script>