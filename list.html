---
layout: base
---

<!-- This is the webpage to show the prerequisites -->

<!-- Import data -->
{% for collection in site.collections %}
    {% for page in collection.docs %}
        <data subject="{{ collection.name }}" chapter="{{ page.url | slice: 1, page.url.size }}">{{ page.prerequisites | join: ', ' }}</data>
    {% endfor %}
{% endfor %}
<main><time datetime=""></time></main>

<!--
    Assign course numbering to each chapter
    Each chapter with be assigned a four-digit code
    The first two digits are the level of the chapter, starting from 00 for subjects with no prerequisites
-->
<script>
    const dataElements = document.querySelectorAll('data');
    const chapters = {};

    // First pass: collect prerequisites
    dataElements.forEach(data => {
        const subject = data.getAttribute('subject');
        const chapter = data.getAttribute('chapter');
        const prerequisites = data.textContent.split(', ').filter(prereq => prereq.trim() !== '');
        chapters[chapter] = { subject, prerequisites, level: 0 };
    });

    // Function to compute level recursively
    function computeLevel(chapter) {
        if (chapters[chapter].level > 0) {
            return chapters[chapter].level;
        }
        if (chapters[chapter].prerequisites.length === 0) {
            chapters[chapter].level = 0;
            return 0;
        }
        let maxPrereqLevel = 0;
        chapters[chapter].prerequisites.forEach(prereq => {
            if (chapters[prereq]) {
                const prereqLevel = computeLevel(prereq);
                if (prereqLevel > maxPrereqLevel) {
                    maxPrereqLevel = prereqLevel;
                }
            }
        });
        chapters[chapter].level = maxPrereqLevel + 1;
        return chapters[chapter].level;
    }

    // Second pass: compute levels
    Object.keys(chapters).forEach(chapter => {
        computeLevel(chapter);
    });

    // sort by level
    const sortedChapters = Object.keys(chapters).sort((a, b) => {
        return chapters[a].level - chapters[b].level;
    });

    // Output result as table, with each row is a level
    const main = document.querySelector('main');;
    const table = document.createElement('table');
    let currentLevel = -1;
    let tbody = null;
    sortedChapters.forEach(chapter => {
        const level = chapters[chapter].level;
        if (level !== currentLevel) {
            currentLevel = level;
            tbody = document.createElement('tbody');
            const headerRow = document.createElement('tr');
            const headerCell = document.createElement('th');
            headerCell.colSpan = 2;
            headerCell.textContent = `Level ${level}`;
            headerRow.appendChild(headerCell);
            tbody.appendChild(headerRow);
            table.appendChild(tbody);
        }
        const row = document.createElement('tr');
        const chapterCell = document.createElement('td');
        chapterCell.textContent = chapter;
        const subjectCell = document.createElement('td');
        subjectCell.textContent = chapters[chapter].subject;
        row.appendChild(chapterCell);
        row.appendChild(subjectCell);
        tbody.appendChild(row);
    });
    main.appendChild(table);
</script>